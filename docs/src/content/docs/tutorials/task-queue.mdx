---
title: Build a Task Queue in 15 Minutes
description: Learn NorthstarDB fundamentals by building a persistent task queue with atomic operations
sidebar:
  order: 1
---

import { Code } from '@astrojs/starlight/components';

Build a complete task queue system in just 15 minutes. This tutorial teaches core NorthstarDB concepts through a practical, real-world example.

## What We're Building

A task queue system that handles:
- **Concurrent task processing** — Multiple workers claim tasks safely
- **Atomic claims** — No duplicate task assignments
- **Crash safety** — All operations persisted to disk
- **Task tracking** — Monitor pending, processing, and completed tasks

<details>
  <summary>Why a task queue?</summary>

  Task queues are perfect for learning because they demonstrate:
  - Real-world database patterns
  - Concurrent access without conflicts
  - Atomic operations for data consistency
  - Persistent storage for reliability

  Plus, task queues power many AI agent orchestration systems — NorthstarDB's target use case.
</details>

## Prerequisites

No installation required! The code runs in your browser.

If you want to run locally:
- [Zig 0.13.0+](https://ziglang.org/download/)
- [NorthstarDB cloned](https://github.com/nikopol/northstardb)

## Step 1: Create Tasks

Let's start by creating some tasks in the database.

export const TaskQueueExamples = [
  {"name":"Creating Tasks","description":"Learn how to store tasks using simple key-value pairs","code":"// Create three tasks\nput:task:1 = Process file upload\nput:task:2 = Generate thumbnails\nput:task:3 = Send notifications\n\n// Verify tasks exist\nget:task:1\nget:task:2\nget:task:3"},
  {"name":"List All Tasks","description":"Use prefix scan to find all tasks","code":"// Create tasks first\nput:task:1 = Process file upload\nput:task:2 = Generate thumbnails\nput:task:3 = Send notifications\nput:task:4 = Backup database\nput:task:5 = Generate report\n\n// In a real app, you'd use scan()\n// Here we just fetch a few keys manually\nget:task:1\nget:task:3\nget:task:5"},
  {"name":"Task Metadata","description":"Store rich task data with JSON","code":"// Store task with metadata\nput:task:email:1 = {\"type\":\"email\",\"to\":\"user@example.com\",\"subject\":\"Welcome\"}\nput:task:process:2 = {\"type\":\"process\",\"input\":\"/data/file.csv\",\"output\":\"/data/result.json\"}\nput:task:notify:3 = {\"type\":\"notification\",\"user\":\"123\",\"message\":\"Task complete\"}\n\n// Retrieve task metadata\nget:task:email:1\nget:task:process:2"}
];

<div class="code-runner" data-default-index="0" style="--editor-height: 280px;" data-examples={JSON.stringify(TaskQueueExamples)}>
	<div class="code-runner-loading">
		<div class="code-runner-spinner"></div>
		<p>Loading WebAssembly module...</p>
	</div>
	<div class="code-runner-error" style="display: none;">
		<p>Failed to load WebAssembly module</p>
		<p class="code-runner-error-details"></p>
		<button class="code-runner-btn code-runner-btn-retry">Retry</button>
	</div>
	<div class="code-runner-content" style="display: none;">
		<div class="code-runner-selector">
			<label>Examples:</label>
			<select class="code-runner-select"></select>
		</div>
		<div class="code-runner-description"></div>
		<div class="code-runner-editor">
			<div class="code-runner-header">
				<span>Code</span>
				<div class="code-runner-actions">
					<button class="code-runner-btn code-runner-btn-copy" title="Copy to clipboard">
						<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
							<path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
							<path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
						</svg>
						Copy
					</button>
					<button class="code-runner-btn code-runner-btn-run" title="Run code (Ctrl+Enter)">
						<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
							<path d="M4 2v12l10-6Z"></path>
						</svg>
						Run
					</button>
				</div>
			</div>
			<textarea class="code-runner-textarea" spellcheck="false"></textarea>
		</div>
		<div class="code-runner-output">
			<div class="code-runner-header">
				<span>Output</span>
				<button class="code-runner-btn code-runner-btn-clear" title="Clear output">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>
					</svg>
				</button>
			</div>
			<pre class="code-runner-output-content"></pre>
			<div class="code-runner-status">
				<span>
					<span class="code-runner-status-dot"></span>
					<span class="code-runner-status-text">Ready</span>
				</span>
				<span class="code-runner-time"></span>
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="/js/code-runner.css" /><script src="/js/code-runner.js"></script>

**What's happening:**
- `put:task:N` — Stores task with ID `N`
- `get:task:N` — Retrieves the task value
- Tasks are persisted immediately to the commit stream

<details>
  <summary>Key naming patterns</summary>

  Task keys follow conventions:
  - `task:1` — Simple numeric ID
  - `task:email:1` — Type-prefixed with ID
  - `task:pending:1` — Status-prefixed

  Consistent prefixes enable efficient prefix scans.
</details>

## Step 2: Claim Tasks Atomically

Multiple workers need to claim tasks without conflicts. NorthstarDB handles this with atomic operations.

export const ClaimExamples = [
  {"name":"Atomic Claim Pattern","description":"Use compare-and-swap to claim tasks safely","code":"// Create a task\nput:task:1 = Process payment\n\n// Create claim record (timestamp prevents duplicate claims)\nput:claim:task:1:worker:1 = 1704067200\n\n// Try to claim (simulate second worker)\nput:claim:task:1:worker:2 = 1704067201\n\n// Check who claimed it\nget:claim:task:1:worker:1\nget:claim:task:1:worker:2"},
  {"name":"Claim Verification","description":"Verify task ownership before processing","code":"// Setup: Create task and claim\nput:task:1 = Send email\nput:claim:task:1:worker:1 = 1704067200\n\n// Worker 1 verifies ownership\nget:claim:task:1:worker:1\n\n// Move to processing state\nput:processing:task:1 = worker:1\n\n// Remove from pending queue (simulated)\nput:task:1:claimed = true"},
  {"name":"Multiple Workers","description":"Two workers competing for tasks","code":"// Create tasks\nput:task:1 = Generate report\nput:task:2 = Send notifications\nput:task:3 = Backup data\n\n// Worker 1 claims task 1 and 2\nput:claim:task:1:worker:1 = 1704067200\nput:claim:task:2:worker:1 = 1704067201\n\n// Worker 2 claims task 3\nput:claim:task:3:worker:2 = 1704067202\n\n// Worker 2 tries to claim task 1 (fails)\nput:claim:task:1:worker:2 = 1704067203\n\n// Check final state\nget:claim:task:1:worker:1\nget:claim:task:1:worker:2"}
];

<div class="code-runner" data-default-index="0" style="--editor-height: 280px;" data-examples={JSON.stringify(ClaimExamples)}>
	<div class="code-runner-loading">
		<div class="code-runner-spinner"></div>
		<p>Loading WebAssembly module...</p>
	</div>
	<div class="code-runner-error" style="display: none;">
		<p>Failed to load WebAssembly module</p>
		<p class="code-runner-error-details"></p>
		<button class="code-runner-btn code-runner-btn-retry">Retry</button>
	</div>
	<div class="code-runner-content" style="display: none;">
		<div class="code-runner-selector">
			<label>Examples:</label>
			<select class="code-runner-select"></select>
		</div>
		<div class="code-runner-description"></div>
		<div class="code-runner-editor">
			<div class="code-runner-header">
				<span>Code</span>
			<div class="code-runner-actions">
				<button class="code-runner-btn code-runner-btn-copy" title="Copy to clipboard">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
						<path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
					</svg>
					Copy
				</button>
				<button class="code-runner-btn code-runner-btn-run" title="Run code (Ctrl+Enter)">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4 2v12l10-6Z"></path>
					</svg>
					Run
				</button>
			</div>
			</div>
			<textarea class="code-runner-textarea" spellcheck="false"></textarea>
		</div>
		<div class="code-runner-output">
			<div class="code-runner-header">
				<span>Output</span>
				<button class="code-runner-btn code-runner-btn-clear" title="Clear output">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>
					</svg>
				</button>
			</div>
			<pre class="code-runner-output-content"></pre>
			<div class="code-runner-status">
				<span>
					<span class="code-runner-status-dot"></span>
					<span class="code-runner-status-text">Ready</span>
				</span>
				<span class="code-runner-time"></span>
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="/js/code-runner.css" /><script src="/js/code-runner.js"></script>

**Key Pattern:** The claim record includes a timestamp, creating a unique key that prevents duplicate claims. In production, you'd check for existing claims before creating a new one.

## Step 3: Complete Tasks

When a worker finishes, mark the task complete and update statistics.

export const CompleteExamples = [
  {"name":"Complete Task","description":"Mark task as done and cleanup claim","code":"// Setup: Task is claimed by worker 1\nput:task:1 = Send email\nput:claim:task:1:worker:1 = 1704067200\n\n// Complete the task\nput:completed:task:1 = {\"worker\":\"worker:1\",\"completed_at\":1704067260}\n\n// Remove claim record (in real app, use delete)\nput:claim:task:1:worker:1 = claimed_and_completed\n\n// Update statistics\nput:stats:worker:1:completed = 42"},
  {"name":"Track Failures","description":"Handle failed tasks with retry logic","code":"// Setup: Task failed during processing\nput:task:1 = Process payment\nput:claim:task:1:worker:1 = 1704067200\n\n// Record failure\nput:failed:task:1 = {\"error\":\"timeout\",\"retries_left\":2}\n\n// Decrease retry count\nput:task:1:retries = 2\n\n// Move back to pending for retry\nput:pending:task:1:retry:3 = true"},
  {"name":"Worker Statistics","description":"Track completed tasks per worker","code":"// Worker 1 completes tasks\nput:stats:worker:1:completed = 10\nput:stats:worker:1:failed = 1\nput:stats:worker:1:total = 11\n\n// Worker 2 completes tasks\nput:stats:worker:2:completed = 8\nput:stats:worker:2:failed = 0\nput:stats:worker:2:total = 8\n\n// Query stats\nget:stats:worker:1:completed\nget:stats:worker:2:completed"}
];

<div class="code-runner" data-default-index="0" style="--editor-height: 280px;" data-examples={JSON.stringify(CompleteExamples)}>
	<div class="code-runner-loading">
		<div class="code-runner-spinner"></div>
		<p>Loading WebAssembly module...</p>
	</div>
	<div class="code-runner-error" style="display: none;">
		<p>Failed to load WebAssembly module</p>
		<p class="code-runner-error-details"></p>
		<button class="code-runner-btn code-runner-btn-retry">Retry</button>
	</div>
	<div class="code-runner-content" style="display: none;">
		<div class="code-runner-selector">
			<label>Examples:</label>
			<select class="code-runner-select"></select>
		</div>
		<div class="code-runner-description"></div>
		<div class="code-runner-editor">
			<div class="code-runner-header">
				<span>Code</span>
				<div class="code-runner-actions">
					<button class="code-runner-btn code-runner-btn-copy" title="Copy to clipboard">
						<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
							<path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
							<path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
						</svg>
						Copy
					</button>
					<button class="code-runner-btn code-runner-btn-run" title="Run code (Ctrl+Enter)">
						<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
							<path d="M4 2v12l10-6Z"></path>
						</svg>
						Run
					</button>
				</div>
			</div>
			<textarea class="code-runner-textarea" spellcheck="false"></textarea>
		</div>
		<div class="code-runner-output">
			<div class="code-runner-header">
				<span>Output</span>
				<button class="code-runner-btn code-runner-btn-clear" title="Clear output">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>
					</svg>
				</button>
			</div>
			<pre class="code-runner-output-content"></pre>
			<div class="code-runner-status">
				<span>
					<span class="code-runner-status-dot"></span>
					<span class="code-runner-status-text">Ready</span>
				</span>
				<span class="code-runner-time"></span>
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="/js/code-runner.css" /><script src="/js/code-runner.js"></script>

## Step 4: Priority Queues

Not all tasks are equal. Let's add priority handling.

export const PriorityExamples = [
  {"name":"Priority Keys","description":"Use key ordering for priority queues","code":"// High priority tasks (priority 0)\nput:queue:high:000:1 = Process payment\nput:queue:high:000:2 = Fraud detection\n\n// Normal priority (priority 1)\nput:queue:normal:001:1 = Send newsletter\nput:queue:normal:001:2 = Generate reports\n\n// Low priority (priority 2)\nput:queue:low:002:1 = Cleanup logs\nput:queue:low:002:2 = Archive data\n\n// Fetch from high priority queue\nget:queue:high:000:1\nget:queue:high:000:2"},
  {"name":"Timestamp Ordering","description":"Combine priority with FIFO ordering","code":"// Use timestamp for FIFO within priority\nput:queue:high:1704067200:1 = Urgent: Fix bug\nput:queue:high:1704067300:2 = Urgent: Security patch\nput:queue:high:1704067400:3 = Urgent: Hotfix\n\n// Within normal priority\nput:queue:normal:1704067200:1 = Weekly report\nput:queue:normal:1704067300:2 = Daily backup\n\n// Tasks are naturally ordered by priority then time\nget:queue:high:1704067200:1"}
];

<div class="code-runner" data-default-index="0" style="--editor-height: 280px;" data-examples={JSON.stringify(PriorityExamples)}>
	<div class="code-runner-loading">
		<div class="code-runner-spinner"></div>
		<p>Loading WebAssembly module...</p>
	</div>
	<div class="code-runner-error" style="display: none;">
		<p>Failed to load WebAssembly module</p>
		<p class="code-runner-error-details"></p>
		<button class="code-runner-btn code-runner-btn-retry">Retry</button>
	</div>
	<div class="code-runner-content" style="display: none;">
		<div class="code-runner-selector">
			<label>Examples:</label>
			<select class="code-runner-select"></select>
		</div>
		<div class="code-runner-description"></div>
		<div class="code-runner-editor">
			<div class="code-runner-header">
				<span>Code</span>
			<div class="code-runner-actions">
				<button class="code-runner-btn code-runner-btn-copy" title="Copy to clipboard">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
						<path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
					</svg>
					Copy
				</button>
				<button class="code-runner-btn code-runner-btn-run" title="Run code (Ctrl+Enter)">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4 2v12l10-6Z"></path>
					</svg>
					Run
				</button>
			</div>
			</div>
			<textarea class="code-runner-textarea" spellcheck="false"></textarea>
		</div>
		<div class="code-runner-output">
			<div class="code-runner-header">
				<span>Output</span>
				<button class="code-runner-btn code-runner-btn-clear" title="Clear output">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>
					</svg>
				</button>
			</div>
			<pre class="code-runner-output-content"></pre>
			<div class="code-runner-status">
				<span>
					<span class="code-runner-status-dot"></span>
					<span class="code-runner-status-text">Ready</span>
				</span>
				<span class="code-runner-time"></span>
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="/js/code-runner.css" /><script src="/js/code-runner.js"></script>

**Pattern:** Keys are lexicographically ordered. `queue:high` comes before `queue:normal`, which comes before `queue:low`. Within each priority, timestamp ordering ensures FIFO.

## Complete Task Queue Flow

Let's put it all together with a complete workflow.

export const CompleteFlowExamples = [
  {"name":"Complete Workflow","description":"Full task lifecycle from creation to completion","code":"// 1. Create tasks\nput:task:1 = Process payment\nput:task:2 = Send email\nput:task:3 = Generate report\n\n// 2. Worker 1 claims task 1\nput:claim:task:1:worker:1 = 1704067200\nput:processing:task:1 = worker:1\n\n// 3. Worker 2 claims task 2\nput:claim:task:2:worker:2 = 1704067201\nput:processing:task:2 = worker:2\n\n// 4. Worker 1 completes task 1\nput:completed:task:1 = {\"worker\":\"worker:1\",\"time\":1704067260}\nput:stats:worker:1:completed = 1\n\n// 5. Check remaining tasks\nget:task:2\nget:task:3"},
  {"name":"Concurrent Workers","description":"Multiple workers processing in parallel","code":"// Create batch of tasks\nput:task:1 = Job A\nput:task:2 = Job B\nput:task:3 = Job C\nput:task:4 = Job D\n\n// Worker 1 claims tasks 1 and 2\nput:claim:task:1:worker:1 = 1704067200\nput:claim:task:2:worker:1 = 1704067201\nput:stats:worker:1:active = 2\n\n// Worker 2 claims tasks 3 and 4\nput:claim:task:3:worker:2 = 1704067202\nput:claim:task:4:worker:2 = 1704067203\nput:stats:worker:2:active = 2\n\n// Both workers complete their tasks\nput:completed:task:1 = done\nput:completed:task:2 = done\nput:completed:task:3 = done\nput:completed:task:4 = done\n\n// Final stats\nget:stats:worker:1:active\nget:stats:worker:2:active"}
];

<div class="code-runner" data-default-index="0" style="--editor-height: 280px;" data-examples={JSON.stringify(CompleteFlowExamples)}>
	<div class="code-runner-loading">
		<div class="code-runner-spinner"></div>
		<p>Loading WebAssembly module...</p>
	</div>
	<div class="code-runner-error" style="display: none;">
		<p>Failed to load WebAssembly module</p>
		<p class="code-runner-error-details"></p>
		<button class="code-runner-btn code-runner-btn-retry">Retry</button>
	</div>
	<div class="code-runner-content" style="display: none;">
		<div class="code-runner-selector">
			<label>Examples:</label>
			<select class="code-runner-select"></select>
		</div>
		<div class="code-runner-description"></div>
		<div class="code-runner-editor">
			<div class="code-runner-header">
				<span>Code</span>
			<div class="code-runner-actions">
				<button class="code-runner-btn code-runner-btn-copy" title="Copy to clipboard">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
						<path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
					</svg>
					Copy
				</button>
				<button class="code-runner-btn code-runner-btn-run" title="Run code (Ctrl+Enter)">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4 2v12l10-6Z"></path>
					</svg>
					Run
				</button>
			</div>
			</div>
			<textarea class="code-runner-textarea" spellcheck="false"></textarea>
		</div>
		<div class="code-runner-output">
			<div class="code-runner-header">
				<span>Output</span>
				<button class="code-runner-btn code-runner-btn-clear" title="Clear output">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>
					</svg>
				</button>
			</div>
			<pre class="code-runner-output-content"></pre>
			<div class="code-runner-status">
				<span>
					<span class="code-runner-status-dot"></span>
					<span class="code-runner-status-text">Ready</span>
				</span>
				<span class="code-runner-time"></span>
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="/js/code-runner.css" /><script src="/js/code-runner.js"></script>

## Key Takeaways

You've learned:

- **Key-Value Storage** — Simple `put`/`get` for task data
- **Atomic Claims** — Timestamp-based claim records prevent duplicates
- **State Tracking** — pending → processing → completed lifecycle
- **Worker Stats** — Track performance per worker
- **Priority Queues** — Use key ordering for priority

## Running Locally

Want to run this for real? Clone the example:

<Code code="cd examples/task_queue && zig build run" />

See the [Task Queue Example](https://github.com/nikopol/northstardb/tree/main/examples/task_queue) for the complete implementation.

## Challenge Exercises

Test your understanding:

1. **Retry Logic**: Add exponential backoff for failed tasks
2. **Dead Letter Queue**: Route tasks that exceed max retries
3. **Task Dependencies**: Implement tasks that depend on other tasks completing first
4. **Worker Heartbeats**: Detect and reclaim tasks from dead workers

## Next Steps

- **[Time Travel Queries](/tutorials/time-travel)** — Query task history at any point in time
- **[Semantic Search](/tutorials/semantic-search)** — Add AI-powered task categorization
- **[Core Concepts](/concepts/mvcc/)** — Deep dive into MVCC and snapshots
- **[API Reference](/reference/db-api/)** — Complete database API documentation
