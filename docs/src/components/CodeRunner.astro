---
/**
 * Interactive Code Runner Component
 *
 * Embeds a WebAssembly-based code runner for executing NorthstarDB examples
 * directly in the browser. Supports predefined examples with copy-paste functionality.
 *
 * This component renders a container that is enhanced by client-side JavaScript.
 *
 * @param {Array<{name: string, code: string, description?: string}>} examples - Array of example objects
 * @param {number} defaultExample - Index of default example to show (default: 0)
 * @param {string} height - Height of the code editor (default: '300px')
 */
interface Props {
	examples: { name: string; code: string; description?: string }[];
	defaultExample?: number;
	height?: string;
}

const { examples, defaultExample = 0, height = '300px' } = Astro.props;

// Generate unique ID for this instance
const instanceId = `runner-${Math.random().toString(36).substring(2, 11)}`;
const examplesJson = JSON.stringify(examples);
---

<div
	id={instanceId}
	class="code-runner"
	data-examples={examplesJson}
	data-default-index={defaultExample}
	style="--editor-height: {height};"
>
	<div class="code-runner-loading">
		<div class="code-runner-spinner"></div>
		<p>Loading WebAssembly module...</p>
	</div>

	<div class="code-runner-error" style="display: none;">
		<p>Failed to load WebAssembly module</p>
		<p class="code-runner-error-details"></p>
		<button class="code-runner-btn code-runner-btn-retry">Retry</button>
	</div>

	<div class="code-runner-content" style="display: none;">
		<div class="code-runner-selector">
			<label>Examples:</label>
			<select class="code-runner-select"></select>
		</div>

		<div class="code-runner-description"></div>

		<div class="code-runner-editor">
			<div class="code-runner-header">
				<span>Code</span>
				<div class="code-runner-actions">
					<button class="code-runner-btn code-runner-btn-copy" title="Copy to clipboard">
						<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
							<path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
							<path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
						</svg>
						Copy
					</button>
					<button class="code-runner-btn code-runner-btn-run" title="Run code (Ctrl+Enter)">
						<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
							<path d="M4 2v12l10-6Z"></path>
						</svg>
						Run
					</button>
				</div>
			</div>
			<textarea class="code-runner-textarea" spellcheck="false"></textarea>
		</div>

		<div class="code-runner-output">
			<div class="code-runner-header">
				<span>Output</span>
				<button class="code-runner-btn code-runner-btn-clear" title="Clear output">
					<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
						<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>
					</svg>
				</button>
			</div>
			<pre class="code-runner-output-content"></pre>
			<div class="code-runner-status">
				<span>
					<span class="code-runner-status-dot"></span>
					<span class="code-runner-status-text">Ready</span>
				</span>
				<span class="code-runner-time"></span>
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="/js/code-runner.css" />
<script src="/js/code-runner.js"></script>
